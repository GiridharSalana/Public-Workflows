name: Sync Secrets Helper

# This workflow receives secrets and sets them in this repository
# It should be triggered by the Blogger-Automation repository's sync workflow

on:
  workflow_dispatch:
    inputs:
      secrets_json:
        description: 'JSON object containing all secrets (base64 encoded for security)'
        required: true
        type: string

jobs:
  set-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Install GitHub CLI
        run: |
          type -p gh >/dev/null || {
            curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
            echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
            sudo apt update
            sudo apt install gh -y
          }

      - name: Set Secrets in Public_Workflows
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SECRETS_JSON: ${{ github.event.inputs.secrets_json }}
        run: |
          # Decode the base64 encoded secrets JSON
          DECODED=$(echo "$SECRETS_JSON" | base64 -d)
          
          # Parse and set each secret
          echo "$DECODED" | jq -r 'to_entries[] | "\(.key)=\(.value)"' | while IFS='=' read -r key value; do
            echo "Setting secret: $key"
            gh secret set "$key" -b"$value" --repo GiridharSalana/Public_Workflows
          done
          
          echo "âœ… All secrets have been synced to Public_Workflows"

